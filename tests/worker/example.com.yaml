name: example.com

# which sub-domains will be redirected? default to @ and www (if empty list). if routes defined - then no defaults included unless configured
# TODO - try to use custom domains for this .. if it is possible to assign them before zone is active
routes:
- blog
- www.qa.internal
- www
- test
- '@'

# TODO - need to capture DNS records where they deviate from default (i.e. @ A 192.0.2.0 and www CNAME @)
dns:
# each record needs: type, name, value, proxied, ttl
- type: A # case-insensitive? initially only cater for common records (in redirect zones) A, AAAA, CNAME, MX, TXT - any other records to throw an error (i.e. not implemented)
  name: '@'
  value: 1.2.3.4
  proxied: true # Cloudflare specific naming?
  #ttl: 3600 # may be omitted for 'auto' - cannot be set for 'proxied: true'
  #priority: 10 # only applicable to MX records
- type: CNAME # case-insensitive? initially only cater for common records (in redirect zones) A, AAAA, CNAME, MX, TXT - any other records to throw an error (i.e. not implemented)
  name: www
  value: example.com
  proxied: true
- type: A # case-insensitive? initially only cater for common records (in redirect zones) A, AAAA, CNAME, MX, TXT - any other records to throw an error (i.e. not implemented)
  name: test
  value: 1.2.3.4
  proxied: false
  ttl: 3600 # may be omitted for 'auto' - cannot be set for 'proxied: true'

# TODO - should all rules be stored as KV? i.e. no 'Page Rules' - to standardize YAML format
# TODO - script needed to validate stored KV values against YAML, i.e. dry-run to show diff
redirects:

- base: www # if no 'base' declared - then redirect acts on all routes
  from: /old/one-a.html
  to: https://foo.com/new/one-a.html

- base: # 'base' may be a list if multiple subdomains require redirect. if base value not in routes, then it will have no effect
    - www
    - blog
  from: /old/one-b.html
  to: https://foo.com/new/one-b.html

- from: /old/one-c.html
  to: https://foo.com/new/one-c.html

- from: ^/old/pattern/(.*)$
  to: https://foo.com/new/pattern/$1
  caseSensitive: true # redirect matching is case-insensitive by default

- from: ^/old/.*?id=([0-9])$
  to: https://foo.com/new?id=$1
  includeParams: true # request query string is not included in the redirect matching by default

- from: ^/(.*)$
  to: https://foo.com
